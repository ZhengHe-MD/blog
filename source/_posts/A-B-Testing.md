---
title: ä½ çš„ A/B æµ‹è¯•é è°±å—ï¼Ÿ
date: 2022-07-04 19:50:21
tags:
mathjax: true
---

æœ€è¿‘ï¼Œæˆ‘ä»¬åœ¨å…¬å¸å†…éƒ¨åšäº†ä¸€äº› [Hacking Growth](https://www.goodreads.com/book/show/31625067-hacking-growth) æ–¹å‘çš„æ¢ç´¢ï¼Œæˆ‘ä»¬å›¢é˜Ÿä¿¨ç„¶æˆäº†å¢é•¿å›¢é˜Ÿï¼Œä»ç”¨æˆ·å¢é•¿ã€è½¬åŒ–çš„å„ä¸ªç¯èŠ‚ä¸Šå°è¯•ä¸åŒçš„ç­–ç•¥ï¼Œæ‹‰æ–°ã€æ¿€æ´»ã€ç•™å­˜ã€ä¿ƒæ´»ã€æˆå•ï¼Œæ•´ä¸ªæ ¸å¿ƒæµç¨‹æ˜¯ä¸€ä¸ªå¤§æ¼æ–—ï¼Œä¸åŒçš„é˜¶æ®µå’Œæ¸ é“åˆå¯ä»¥æ‹†åˆ†æˆä¸åŒçš„å°æ¼æ–—ï¼Œå“ªä¸ªç¯èŠ‚æŸå¤±å¤§å°±ä¼˜åŒ–å“ªä¸ªã€‚ä½†æ— è®ºåšä½•ç§å°è¯•ï¼Œéƒ½ç»•ä¸å¼€ A/B æµ‹è¯•ã€‚

å¯¹äºä¸€åå·¥ç¨‹å¸ˆï¼Œæˆ‘è®¤ä¸º A/B æµ‹è¯•æœ‰ä¸¤ä¸ªè§’åº¦å€¼å¾—äº†è§£ï¼š

1. å¦‚ä½•æ­å»ºä¸€ä¸ª A/B æµ‹è¯•å¹³å°ï¼Œæ”¯æŒæµé‡åˆ†å±‚ã€è½¬å‘ï¼Œè®©ä¸åŒå®éªŒå…±äº«æµé‡ï¼›

2. å¦‚ä½•è§£è¯»ä¸€ä¸ª A/B æµ‹è¯•çš„ç»“æœï¼Œä»ä¸­å¾—å‡ºæ­£ç¡®çš„ç»“è®ºï¼ŒæŒ‡å¯¼åç»­ç”Ÿäº§å®è·µï¼›

å¯¹äºå‰è€…ï¼Œä¸šç•Œå·²ç»æœ‰è®¸å¤šæœ€ä½³å®è·µï¼Œæ¯”å¦‚ä¹‹å‰å¼•æˆ‘å…¥é—¨çš„è¿™ç¯‡è®ºæ–‡ [Overlapping Experiment Infrastructure](https://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/36500.pdf)ï¼Œä»¥åŠä¼´é±¼çš„å°ä¼™ä¼´ä»¬å†™çš„ä¸¤ç¯‡å®è·µæ€»ç»“ [[1](https://xie.infoq.cn/article/d62fed8fdfdf87ec1d9779f79)]ã€[[2](https://tech.ipalfish.com/blog/2020/06/25/ab_test_evolu/)]ï¼›æœ¬æ–‡æƒ³èŠçš„æ˜¯åè€…ï¼Œ**å¦‚ä½•è§£è¯» A/B æµ‹è¯•çš„ç»“æœ**ï¼Ÿ

## å»ºç«‹ç›´è§‰ï¼šæ€ä¹ˆå®šä¹‰ã€Œæ›´å¥½ã€

A/B æµ‹è¯•ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æœ‰ A å’Œ B ä¸¤ç§æ–¹æ¡ˆï¼Œæµ‹è¯•çš„ç›®çš„å°±æ˜¯è¦çŸ¥é“ã€ŒA æ›´å¥½è¿˜æ˜¯ B æ›´å¥½ã€ã€‚å‡è®¾ç°åœ¨çš„åœºæ™¯æ˜¯ç»™ä¸€ä¸ªç”¨æˆ·ç¾¤åœ¨åŒæ ·çš„æ—¶é—´æ‹¨æ‰“æ™ºèƒ½ç”µè¯ï¼Œå¯¹å…¶ä¸­çš„ä¸€åŠç”¨æˆ·ä½¿ç”¨è¯æœ¯ Aï¼Œå¦ä¸€åŠä½¿ç”¨è¯æœ¯ Bï¼Œæ‹¨æ‰“åçš„ç»“æœåªæœ‰ä¸¤ç§ï¼šæœ‰æ„å‘å’Œæ— æ„å‘ã€‚æ„å‘ç‡å°±æ˜¯æ„å‘ç”¨æˆ·æ€»æ•°ä¸æ¥é€šç”¨æˆ·æ€»æ•°ä¹‹æ¯”ã€‚

å¦‚æœè¯æœ¯ A æ¯”è¯æœ¯ B æ›´å¥½ï¼Œæ˜¯å¦æ„å‘³ç€æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡å®éªŒï¼Œè¯æœ¯ A çš„æ„å‘ç‡æ°¸è¿œé«˜äºè¯æœ¯ Bï¼Ÿæ¢ä¸€ä¸ªä¾‹å­ï¼šA é€‰æ‰‹å’Œ B é€‰æ‰‹åœ¨ä¸–ç•Œç¾½è”çš„æ’ååˆ†åˆ«æ˜¯ä¸–ç•Œç¬¬ä¸€å’Œä¸–ç•Œç¬¬äºŒï¼Œæ˜¯å¦æ„å‘³ç€ï¼š

1. A é€‰æ‰‹ä¸ B é€‰æ‰‹äº¤æˆ˜ï¼ŒA é€‰æ‰‹æ€»æ˜¯èƒ½è·èƒœ

2. B é€‰æ‰‹å¦‚æœèƒ½èƒœè¿‡ C é€‰æ‰‹ (æ’åç¬¬ä¸‰æˆ–ä¹‹å)ï¼ŒA é€‰æ‰‹ä¹Ÿå¿…ç„¶èƒ½èƒœè¿‡ C é€‰æ‰‹

äº‹å®å¹¶éå¦‚æ­¤ï¼Œæˆ‘ä»¬èƒ½è§‚å¯Ÿåˆ°çš„åªæ˜¯ï¼š A é€‰æ‰‹å’Œæ‰€æœ‰å¯¹æ‰‹çš„äº¤æ‰‹æˆ˜ç»© (è·èƒœç§¯åˆ†) è¦ç•¥ä¼˜äº B é€‰æ‰‹ã€‚å›åˆ°è¯æœ¯ A ä¸è¯æœ¯ Bï¼Œè¯æœ¯ A æ¯”è¯æœ¯ B æ›´å¥½ï¼Œåªæ„å‘³ç€ï¼Œå¦‚æœåšå¾ˆå¤šæ¬¡å®éªŒï¼Œè¯æœ¯ A èƒ½åœ¨æ›´å¤šæ¬¡çš„å®éªŒä¸­èƒ½å–å¾—æ¯”è¯æœ¯ B æ›´é«˜çš„æ„å‘ç‡ï¼Œè€Œåœ¨å•æ¬¡å®éªŒä¸­ï¼Œè¯æœ¯ B ä»ç„¶å¯èƒ½å–å¾—æ¯”è¯æœ¯ A æ›´é«˜çš„æ„å‘ç‡ã€‚

> ğŸ’¡ã€Œæ›´å¥½ã€æ˜¯æ¦‚ç‡æ›´é«˜çš„å¥½ï¼Œè€Œä¸æ˜¯ç»å¯¹çš„å¥½ã€‚

å®šä¹‰äº†ã€Œæ›´å¥½ã€ï¼Œå°±ä¸éš¾å®šä¹‰ã€Œå¥½çš„ç¨‹åº¦ã€ã€‚åœ¨ 100 æ¬¡å®éªŒä¸­ï¼Œè€ƒè™‘ä¸‹åˆ—ä¸¤ç§æƒ…å†µï¼š

1. è¯æœ¯ A æœ‰ 60 æ¬¡å–å¾—æ¯”è¯æœ¯ B æ›´é«˜çš„æ„å‘ç‡

2. è¯æœ¯ A æœ‰ 90 æ¬¡å–å¾—æ¯”è¯æœ¯ B æ›´é«˜çš„æ„å‘ç‡

ä¸éš¾æƒ³è±¡ï¼Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œè¯æœ¯ A ã€Œå¥½çš„ç¨‹åº¦ã€æ›´å¤§ä¸€äº›ï¼Œè€Œæ›´å¤§çš„ç¨‹åº¦å°±æ„å‘³ç€æ›´å……è¶³çš„ä¿¡å¿ƒã€‚å‡è®¾ç»“è®ºæ˜¯ã€Œè¯æœ¯ A æ¯”è¯æœ¯ B æ›´å¥½ã€ï¼Œé‚£ä¹ˆè§‚æµ‹åˆ° 2 è‚¯å®šæ¯”è§‚æµ‹åˆ° 1 æ›´é è°±ã€‚å› ä¸º æƒ…å†µ 1 å¯èƒ½ç”±ä¸€äº›éšæœºå› ç´ å¼•å‘ï¼Œæ¯”å¦‚æ°å¥½åœ¨æœ¬æ¬¡å®éªŒä¸­ä½¿ç”¨ A è¯æœ¯æ‹¨æ‰“çš„ç”¨æˆ·ä¸­æ­£åœ¨å¼€ä¼šçš„å¤šä¸€äº›ã€‚ä½†è¿™äº›éšæœºå› ç´ å‡ºç°å¾ˆéš¾å‘ˆç°ä¸€è¾¹å€’çš„æƒ…å†µï¼Œå› æ­¤æƒ…å†µ 2 ä¸å¤ªå¯èƒ½ç”±ç±»ä¼¼çš„å› ç´ å¼•å‘ã€‚

## å‡è®¾æ£€éªŒ - ä»¥ Permutation Test ä¸ºä¾‹

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹äº† A/B æµ‹è¯•ä¸­å…³äºã€Œæ›´å¥½ã€çš„ç›´è§‰ï¼Œæœ¬èŠ‚å°±æ¥æ¯”è¾ƒæ­£å¼åœ°åˆ†æä¸€ä¸ªå…·ä½“åœºæ™¯ â€”â€”

**å®éªŒç»“æœ**ï¼šå‡è®¾å…¶å®ƒæ¡ä»¶ç›¸å½“ï¼Œæˆ‘ä»¬ç”¨ A è¯æœ¯å’Œ B è¯æœ¯åˆ†åˆ«æ‹¨æ‰“ 10000 é€šç”µè¯ï¼Œå…¶ä¸­ A è¯æœ¯æ¥é€šäº† 3469 é€šï¼ŒB è¯æœ¯æ¥é€šäº† 2798 é€šã€‚åœ¨ A è¯æœ¯æ¥é€šçš„ç”µè¯ä¸­ï¼Œæœ‰ 98 ä½ç”¨æˆ·æœ‰æ„å‘ï¼›è€Œåœ¨ B è¯æœ¯æ¥é€šçš„ç”µè¯ä¸­ï¼Œæœ‰ 43 ä½ç”¨æˆ·æœ‰æ„å‘ã€‚

è¿™é‡Œç”µè¯æ˜¯å¦æ¥é€šä¸è¯æœ¯æ— å…³ï¼Œå› æ­¤æˆ‘ä»¬åªå…³å¿ƒæ¥é€šç”µè¯çš„æ„å‘æƒ…å†µã€‚ä¸Šè¿°å®éªŒç»“æœå¯ä»¥æ€»ç»“ä¸ºä¸‹è¡¨ï¼š

|     | A     | B     |
| --- | ----- | ----- |
| æ¥é€š  | 3469  | 2798  |
| æ„å‘  | 98    | 43    |
| æ„å‘ç‡ | 2.83% | 1.54% |

ä»ç»å¯¹æ•°å€¼ä¸Šçœ‹ï¼ŒA è¯æœ¯çš„æ„å‘ç‡è¦é«˜äº B è¯æœ¯ï¼Œä¼¼ä¹æ„å‘³ç€ A è¯æœ¯æ›´å¥½ï¼Œé‚£è¿™æ¬¡å®éªŒçš„ç»“æœæ˜¯ä¸ªå·§åˆå—ï¼ŸåŸºäºæ­¤ï¼Œæˆ‘ä»¬çš„å‡è®¾å¦‚ä¸‹ï¼š

* é›¶å‡è®¾ï¼šè¯æœ¯ A æ²¡æœ‰æ¯”è¯æœ¯ B æ›´å¥½

* å¤‡æ‹©å‡è®¾ï¼šè¯æœ¯ A æ¯”è¯æœ¯ B æ›´å¥½

ä¸‹é¢ä½¿ç”¨çš„å‡è®¾æ£€éªŒæ–¹æ³•å« Permutation Testï¼Œä¸»è¦å› ä¸ºå®ƒ[å¾ˆç¬¦åˆç›´è§‰ï¼Œæ²¡æœ‰å‚æ•°ï¼Œä¸(å·²)éœ€(ç»)è¦(å¿˜)å…¬(å…‰)å¼(å…‰)](https://www.jwilber.me/permutationtest/)ã€‚Permutation Test åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠå½“å‰çš„æ„å‘ç”¨æˆ· (98+43=141) é‡æ–°éšæœºæ‰“æ•£åˆ†é…åˆ°æ± å­ (3469+2798 = 6267) ä¸­ï¼Œç„¶åä»æ± å­ä¸­éšæœºå– 3469 ä¸ªç”¨æˆ·å½’å±äº A è¯æœ¯ï¼Œå‰©ä¸‹çš„å½’å±äº B è¯æœ¯ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡éšæœºçš„æ¨¡æ‹Ÿå®éªŒã€‚å‡è®¾æ¨¡æ‹Ÿå®éªŒåæœ‰ X ä¸ªç”¨æˆ·å½’å±äº A è¯æœ¯ï¼ŒY ä¸ªç”¨æˆ·å½’å±äº B è¯æœ¯ï¼Œé‚£ä¹ˆ X å’Œ Y æ»¡è¶³ï¼š

$$
X + Y = 141, X \ge 0, Y \ge 0
$$

å¦‚æœé‡å¤åš 10000 æ¬¡è¿™æ ·çš„æ¨¡æ‹Ÿå®éªŒï¼Œå¹¶ä»¥ X-Y (è¿™é‡Œä»¥ X-Yã€Y-Xã€X æˆ–è€… Y ä¸ºä¾‹çš†å¯) çš„å€¼ä¸ºæ¨ªåæ ‡ï¼Œå‡ºç°é¢‘æ¬¡ `Freq(X-Y)` ä¸ºçºµåæ ‡ï¼Œå°±å¾ˆå®¹æ˜“å¾—åˆ°ä¸€ä¸ªç±»ä¼¼æ­£æ€åˆ†å¸ƒçš„é’Ÿå‹æ›²çº¿ï¼š

![X é¢‘ç‡ç›´æ–¹å›¾](./freq-x.png)

å®ƒå°±æ˜¯éšæœºå˜é‡ X-Y çš„é¢‘åº¦ç›´æ–¹å›¾ï¼Œç†è®ºä¸Šå®ƒçš„å½¢çŠ¶åº”è¯¥è¶‹è¿‘äºå˜é‡ X-Y çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚æœ‰äº† X-Y çš„é¢‘åº¦ç›´æ–¹å›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°æœ¬èŠ‚åˆæåˆ°çš„å®éªŒç»“æœ (x-y = 55) åœ¨ç›´æ–¹å›¾ä¸­çš„ä½ç½®ï¼š

![åŠ ä¸Šæ ‡è®°çš„ X é¢‘ç‡ç›´æ–¹å›¾](./freq-x-with-mark.png)

åˆ©ç”¨ x-y åœ¨é¢‘åº¦ç›´æ–¹å›¾ä¸­çš„ä½ç½®ï¼Œæˆ‘ä»¬å°±èƒ½ä¼°ç®—å‡º x-y åœ¨éšæœºå˜é‡ X-Y æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸Šçš„åˆ†ä½ç‚¹ã€‚åœ¨ä¸€æ¬¡æ¨¡æ‹Ÿå®éªŒä¸­ï¼Œæˆ‘ä»¬ç®—å¾—çš„åˆ†ä½ç‚¹ä¸º 0.05%ï¼Œè¿™æ„å‘³ç€ã€Œå¦‚æœé›¶å‡è®¾æˆç«‹ï¼Œè§‚æµ‹åˆ° x çš„æ¦‚ç‡ä¸º 0.05%ã€ï¼Œå³åšä¸€ä¸‡æ¬¡å®éªŒï¼Œåªæœ‰äº”æ¬¡èƒ½è§‚æµ‹åˆ° x-y >= 55ã€‚è¿™æ˜¯ä¸ªå°æ¦‚ç‡äº‹ä»¶ï¼Œæˆ‘ä»¬æœ‰ä¿¡å¿ƒé€‰æ‹©æ‹’ç»é›¶å‡è®¾ï¼Œç›¸ä¿¡å¤‡æ‹©å‡è®¾ï¼Œå¦‚æœä¸€å®šè¦ç»™è¿™ä¸ªä¿¡å¿ƒåŠ ä¸€ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆæˆ‘å¸Œæœ›æ˜¯ 99.95% (1-0.05%)ã€‚

å¦‚æœä½ å¬è¿‡è’™ç‰¹å¡æ´›æ–¹æ³• (Monte Carlo Method)ï¼Œåˆšæ‰è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿã€‚å®ç°é€»è¾‘å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡ gist [AB-Permutation-Test Â· GitHub](https://gist.github.com/ZhengHe-MD/48e633ec49a35b5259908cf468dc073b)ã€‚

## å‚è€ƒ

* [Hacking Growth](https://www.goodreads.com/book/show/31625067-hacking-growth)

* [The Permutation Test]([Permutation Test: Visual Explanation](https://www.jwilber.me/permutationtest/))

* [Statistical Significance in A/B testing (Calculation, p-value and the Math)](https://data36.com/statistical-significance-in-ab-testing/)

* [AB-Permutation-Test Â· GitHub](https://gist.github.com/ZhengHe-MD/48e633ec49a35b5259908cf468dc073b)
