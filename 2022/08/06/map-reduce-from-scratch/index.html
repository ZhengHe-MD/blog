<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhenghe-md.github.io","root":"/blog/","images":"/blog/images","scheme":"Mist","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"remove","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/blog/js/config.js"></script>
<meta name="description" content="åœ¨æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œä¸ºäº†åšæ•°æ®åˆ†æï¼Œæˆ‘å¼€å§‹å†™ä¸€äº›å¤æ‚çš„ HiveSQLã€‚æ¯æ¬¡æ‰§è¡Œ HiveSQL æ—¶ï¼Œéƒ½ä¼šçœ‹åˆ° Map&#x2F;Reduce jobs è¢«è°ƒåº¦ã€æ‰§è¡Œï¼Œç›´åˆ°æœ€åå±•ç¤ºå‡ºæ•°æ®ã€‚æ¸æ¸åœ°æˆ‘å¿ƒä¸­å¤šäº†ä¸¤ä¸ªç–‘é—®ï¼š  MapReduce å¼•æ“å¦‚ä½•å·¥ä½œï¼Ÿ SQL æ˜¯å¦‚ä½•è¢«ç¿»è¯‘æˆ MapReduce job çš„ï¼Ÿ  ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªç–‘é—®ï¼Œæˆ‘ç”¨æ¯”è¾ƒç†Ÿæ‚‰çš„ Go è¯­è¨€å®ç°äº†ä¸€ä¸ªç©å…·ç‰ˆæœ¬çš„ MapReduce å¼•æ“ï¼Œç„¶ååŸº">
<meta property="og:type" content="article">
<meta property="og:title" content="ä» MapReduce åˆ° SQL">
<meta property="og:url" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/index.html">
<meta property="og:site_name" content="ZhengHe">
<meta property="og:description" content="åœ¨æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œä¸ºäº†åšæ•°æ®åˆ†æï¼Œæˆ‘å¼€å§‹å†™ä¸€äº›å¤æ‚çš„ HiveSQLã€‚æ¯æ¬¡æ‰§è¡Œ HiveSQL æ—¶ï¼Œéƒ½ä¼šçœ‹åˆ° Map&#x2F;Reduce jobs è¢«è°ƒåº¦ã€æ‰§è¡Œï¼Œç›´åˆ°æœ€åå±•ç¤ºå‡ºæ•°æ®ã€‚æ¸æ¸åœ°æˆ‘å¿ƒä¸­å¤šäº†ä¸¤ä¸ªç–‘é—®ï¼š  MapReduce å¼•æ“å¦‚ä½•å·¥ä½œï¼Ÿ SQL æ˜¯å¦‚ä½•è¢«ç¿»è¯‘æˆ MapReduce job çš„ï¼Ÿ  ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªç–‘é—®ï¼Œæˆ‘ç”¨æ¯”è¾ƒç†Ÿæ‚‰çš„ Go è¯­è¨€å®ç°äº†ä¸€ä¸ªç©å…·ç‰ˆæœ¬çš„ MapReduce å¼•æ“ï¼Œç„¶ååŸº">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/map-reduce-word-count.png">
<meta property="og:image" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/map-reduce-entities.png">
<meta property="og:image" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/map-reduce-files.png">
<meta property="og:image" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/map-reduce-select.png">
<meta property="og:image" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/map-reduce-join.png">
<meta property="article:published_time" content="2022-08-06T22:16:08.000Z">
<meta property="article:modified_time" content="2023-01-06T13:51:11.564Z">
<meta property="article:author" content="ZhengHe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/map-reduce-word-count.png">


<link rel="canonical" href="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/","path":"2022/08/06/map-reduce-from-scratch/","title":"ä» MapReduce åˆ° SQL"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä» MapReduce åˆ° SQL | ZhengHe</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-172943223-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-172943223-1","only_pageview":false}</script>
  <script src="/blog/js/third-party/analytics/google-analytics.js"></script>





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container {
  overflow: auto hidden;
}

mjx-container + br {
  display: none;
}
</style><link rel="alternate" href="/blog/atom.xml" title="ZhengHe" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ZhengHe</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li>
        <li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li>
        <li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
        <li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/ZhengHe-MD" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhenghe-md.github.io/blog/2022/08/06/map-reduce-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="ZhengHe">
      <meta itemprop="description" content="éƒ‘é¹¤çš„åšå®¢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhengHe">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä» MapReduce åˆ° SQL
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-08-06 22:16:08" itemprop="dateCreated datePublished" datetime="2022-08-06T22:16:08+00:00">2022-08-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-06 13:51:11" itemprop="dateModified" datetime="2023-01-06T13:51:11+00:00">2023-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">å®è·µ</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2022/08/06/map-reduce-from-scratch/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/08/06/map-reduce-from-scratch/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>åœ¨æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œä¸ºäº†åšæ•°æ®åˆ†æï¼Œæˆ‘å¼€å§‹å†™ä¸€äº›å¤æ‚çš„ HiveSQLã€‚æ¯æ¬¡æ‰§è¡Œ HiveSQL æ—¶ï¼Œéƒ½ä¼šçœ‹åˆ° Map/Reduce jobs è¢«è°ƒåº¦ã€æ‰§è¡Œï¼Œç›´åˆ°æœ€åå±•ç¤ºå‡ºæ•°æ®ã€‚æ¸æ¸åœ°æˆ‘å¿ƒä¸­å¤šäº†ä¸¤ä¸ªç–‘é—®ï¼š</p>
<ol type="1">
<li><p>MapReduce å¼•æ“å¦‚ä½•å·¥ä½œï¼Ÿ</p></li>
<li><p>SQL æ˜¯å¦‚ä½•è¢«ç¿»è¯‘æˆ MapReduce job çš„ï¼Ÿ</p></li>
</ol>
<p>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªç–‘é—®ï¼Œæˆ‘ç”¨æ¯”è¾ƒç†Ÿæ‚‰çš„ Go è¯­è¨€å®ç°äº†ä¸€ä¸ªç©å…·ç‰ˆæœ¬çš„ MapReduce å¼•æ“ï¼Œç„¶ååŸºäºæ­¤å®ç°åŸºæœ¬çš„ selectï¼Œjoinã€‚</p>
<blockquote>
<p>æœ¬æ–‡ç›¸å…³çš„æºç æ”¾åœ¨ä»“åº“ <a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/pset/tree/main/map-reduce/go/mapreduce">ZhengHe-MD/pset Â· GitHub</a> ä¸­ï¼Œæ¬¢è¿æŸ¥é˜…ã€‚</p>
</blockquote>
<span id="more"></span>
<h2 id="mapreduce-çš„åŸºæœ¬è¿‡ç¨‹">1. MapReduce çš„åŸºæœ¬è¿‡ç¨‹</h2>
<p>å¦‚æœä½ è¯»è¿‡ Google çš„è¿™ç¯‡è®ºæ–‡ <a target="_blank" rel="noopener" href="https://static.googleusercontent.com/media/research.google.com/zh-CN//archive/mapreduce-osdi04.pdf">MapReduce: Simplified Data Processing on Large Clusters</a>ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡æœ¬èŠ‚ã€‚å¦‚æœä½ æ²¡è¯»è¿‡æˆ–è€…æœ‰äº›é—å¿˜ï¼Œåˆ™ä¸å¦¨å¾€ä¸‹çœ‹ã€‚</p>
<p>MapReduce job çš„ä¸€èˆ¬æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="./map-reduce-word-count.png" /></p>
<blockquote>
<p>æ³¨ï¼šå›¾ä¸­æ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶</p>
</blockquote>
<ol type="1">
<li><p>è¾“å…¥æ•°æ®æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼Œéœ€è¦å…ˆæŠŠå®ƒåˆ‡åˆ†æˆè‹¥å¹²å­æ–‡ä»¶ï¼›</p></li>
<li><p>Map è¿‡ç¨‹å°†å•ä¸ªå­æ–‡ä»¶ä¸­çš„åŸå§‹æ•°æ®è½¬åŒ–æˆä¸€ç»„é”®å€¼å¯¹ã€‚é”®å€¼å¯¹ä¸­é”®å€¼çš„å«ä¹‰ç”±å¼€å‘è€…å®šä¹‰ã€‚æ¯ä¸ªå­æ–‡ä»¶äº§ç”Ÿçš„é”®å€¼å¯¹ä¼šæŒ‰ç…§å¯¹åº”çš„é”®æ•£åˆ—åˆ°è‹¥å¹²ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œåœ¨ä¸‹æ–‡ä¸­æˆ‘å°†ç§°è¿™äº›ä¸´æ—¶æ–‡ä»¶ä¸º mapped fileã€‚é”®çš„æ•£åˆ—å€¼ (<code>hash(key)</code>) ç›¸åŒçš„æ•°æ®ä¼šè¢«å†™å…¥åŒä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼›</p></li>
<li><p>Reduce è¿‡ç¨‹å…ˆè¯»å–å¯¹åº”æ•£åˆ—å€¼çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ ¹æ®éœ€è¦é‡æ’é‡Œè¾¹çš„é”®å€¼å¯¹ï¼Œæœ€åä¾ç…§ç›®æ ‡èšåˆæ•°æ®ï¼›</p></li>
<li><p>Reduce äº§å‡ºçš„æ–‡ä»¶ï¼Œæ—¢å¯ä»¥è¢«ç”¨ä½œå¦ä¸€ä¸ª MapReduce job çš„è¾“å…¥å­æ–‡ä»¶ï¼Œå³ç¬¬ 1 æ­¥çš„è¾“å‡ºç»“æœï¼Œä¹Ÿå¯ä»¥è¢«ç›´æ¥åˆå¹¶æˆç»“æœæ–‡ä»¶è¾“å‡ºã€‚</p></li>
</ol>
<p>ä»¥å›¾ä¸­çš„ã€Œè¯é¢‘è®¡ç®—ã€ä¸ºä¾‹ï¼ŒMap è¿‡ç¨‹è¯»å–æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªè¯ï¼Œç”Ÿæˆé”®ä¸ºè¯è¯­ã€å€¼ä¸ºå¸¸æ•° 1 çš„é”®å€¼å¯¹ï¼Œå¦‚ "Deer, 1"ã€"Car, 1"ã€‚é”®æ•£åˆ—å€¼ç›¸åŒçš„æ•°æ®ä¼šè¢«æ•£åˆ—åˆ°ç›¸åŒçš„ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œäº¤ç»™å¯¹åº”çš„ Reduce è¿‡ç¨‹ã€‚Reduce è¿‡ç¨‹è·å–æ•£åˆ—å€¼ç›¸åŒçš„é”®å€¼å¯¹åï¼Œå…ˆåšä¸€æ¬¡æ’åºï¼Œä½¿é”®ç›¸åŒçš„æ•°æ®ç‰©ç†ä¸Šç›¸é‚»ï¼Œå¦‚å›¾ä¸­çš„ 3 ä¸ª "Car, 1"ï¼Œç„¶åç›´æ¥åŠ æ€»è®¡æ•°å€¼å³å¯å¾—åˆ° "Car, 3"ï¼Œå³å•è¯ "Car" å‡ºç° 3 æ¬¡ã€‚åˆå¹¶æ‰€æœ‰è¾“å‡ºæ–‡ä»¶å°±å¾—åˆ°äº†æ‰€æœ‰è¯è¯­çš„é¢‘åº¦ç»Ÿè®¡ç»“æœã€‚</p>
<p>ä»æ€§èƒ½ä¸Šçœ‹ï¼ŒMap å’Œ Reduce çš„æ‰§è¡Œå®ä¾‹å¯ä»¥ä¾æ® job çš„å¤§å°è‡ªç”±æ‰©å±•ï¼Œä½¿å¾— Map é˜¶æ®µå’Œ Reduce é˜¶æ®µå„è‡ªå¯ä»¥æ¨ªå‘æ‰©å®¹è®¡ç®—èƒ½åŠ›ã€‚å¦å¤–ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­çš„å‘ç”Ÿçš„æ•°æ®è¯»å†™å½¢å¼åªæœ‰é¡ºåº I/Oï¼Œèƒ½å……åˆ†æ»¡è¶³å¤§æ•°æ®å¯¹ååçš„éœ€æ±‚ã€‚</p>
<h2 id="å®ç°ä¸€ä¸ªç©å…·ç‰ˆ-mapreduce-å¼•æ“">2. å®ç°ä¸€ä¸ªç©å…·ç‰ˆ MapReduce å¼•æ“</h2>
<blockquote>
<p>ğŸ’¡ What I cannot create, I do not understand.</p>
</blockquote>
<p>åœ¨è¿›å…¥æ­£æ–‡ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆå£°æ˜ï¼šè¿™ä¸ªå¼•æ“å¹¶ä¸æ˜¯æˆ‘ä»æ— åˆ°æœ‰é€ å‡ºæ¥çš„ã€‚åœ¨å¼€å¹²ä¹‹å‰ï¼Œæˆ‘æƒ³èµ· 4 å¹´å‰åšè¿‡çš„ MIT-6.824 ä½œä¸šä¸­ç¬¬ä¸€ä¸ª lab å°±æ˜¯ MapReduceã€‚äºæ˜¯æˆ‘å…ˆé€šè¯»äº†ä¸€éè¯¾ç¨‹è®¾è®¡è€…æä¾›çš„æºç ï¼Œéšåæ‰æ’¸èµ·è¢–å­å¼€å¹²ï¼Œè¿™ä¸ªè¿‡ç¨‹è‚¯å®šä¼šæœ‰ä¸€äº›å‚è€ƒå’Œå€Ÿé‰´ã€‚</p>
<h3 id="é¢†åŸŸå®ä½“-entities">2.1 é¢†åŸŸå®ä½“ (Entities)</h3>
<p>MapReduce å¼•æ“éœ€è¦èƒ½æ¥æ”¶ç”¨æˆ·æäº¤çš„ä»»åŠ¡ï¼Œå¹¶å°†å®ƒæ‹†è§£æˆå¤šä¸ªå°çš„è®¡ç®— (map/reduce) å­ä»»åŠ¡ï¼Œåˆ†å‘åˆ°è®¡ç®—èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="./map-reduce-entities.png" /></p>
<p>è¿™é‡Œè‡³å°‘æ¶‰åŠ 5 ä¸ªå®ä½“ï¼šClusterã€Masterã€Workerã€Job å’Œ Taskã€‚Cluster è´Ÿè´£ç®¡ç†é›†ç¾¤çš„å…ƒä¿¡æ¯ã€å¯åŠ¨å’Œå…³é—­ï¼›master èŠ‚ç‚¹è´Ÿè´£ worker èŠ‚ç‚¹çš„æ³¨å†Œã€å‘ç°ï¼Œæ¥æ”¶ç”¨æˆ·æäº¤çš„ jobï¼Œæ‹†è§£æˆå­ä»»åŠ¡ taskï¼Œåˆ†å‘ç»™ worker èŠ‚ç‚¹æ‰§è¡Œã€‚ç”±äº map ä¸ reduce å­ä»»åŠ¡åœ¨å…ƒæ•°æ®å’Œæ‰§è¡Œè¿‡ç¨‹å¹¶ä¸ç›¸åŒï¼Œä¸ºäº†æºç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒTask åˆè¢«è¿›ä¸€æ­¥æ‹†åˆ†æˆ MapTask ä¸ ReduceTask ä¸¤ä¸ªå­ç±»ã€‚</p>
<blockquote>
<p>å¤‡æ³¨ï¼šä¸ºäº†è¡¨è¿°æ¸…æ™°ï¼Œä¸‹æ–‡ä¸­ä¼šå°†æ‰§è¡Œ map task çš„ worker ç§°ä¸º mapperï¼Œæ‰§è¡Œ reduce task çš„ worker ç§°ä¸º reducerã€‚</p>
</blockquote>
<h3 id="é¢†åŸŸè¿‡ç¨‹-interfaces">2.2 é¢†åŸŸè¿‡ç¨‹ (Interfaces)</h3>
<p>è°ˆåˆ° MapReduce å¼•æ“çš„é¢†åŸŸè¿‡ç¨‹ï¼Œè‡ªç„¶å°‘ä¸äº† map å’Œ reduceã€‚æ­¤å¤–ï¼Œæ•°æ®åœ¨è®¡ç®—å­ä»»åŠ¡ä¹‹é—´æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å…±äº«ï¼Œå› æ­¤æ•°æ®çš„ç¼–è§£ç ä¹Ÿæ˜¯å¼•æ“é‡Œé‡è¦çš„è¿‡ç¨‹ã€‚</p>
<p>mapper å°†è¾“å…¥æ•°æ®æŒ‰è®¡ç®—ç›®æ ‡è§£ææˆé”®å€¼å¯¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mapper is the interface that wraps the basic Map method.</span></span><br><span class="line"><span class="keyword">type</span> Mapper <span class="keyword">interface</span> &#123;</span><br><span class="line">    Map(data []<span class="keyword">byte</span>) ([]KeyValue, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>reducer å°†é”®ç›¸åŒçš„é”®å€¼å¯¹èšåˆï¼Œç”±äºè¾“å‡ºçš„é”®ä¸è¾“å…¥ç›¸åŒï¼Œåœ¨è¿”å›å€¼ä¸­åªéœ€è¦ç»™å‡ºè®¡ç®—ç»“æœå³å¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Reducer is the interface that wraps the basic Reduce method.</span></span><br><span class="line"><span class="keyword">type</span> Reducer <span class="keyword">interface</span> &#123;</span><br><span class="line">    Reduce(key <span class="keyword">string</span>, values []<span class="keyword">string</span>) (<span class="keyword">string</span>, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ¯ä¸ªè®¡ç®—ä»»åŠ¡çš„ map å’Œ reduce è¿‡ç¨‹æœ¬å°±æ˜¯ä¸ºäº†å®ŒæˆæŸä¸ªç‰¹å®šçš„è®¡ç®—ç›®æ ‡ï¼ŒäºŒè€…çš„é€»è¾‘æœ‰å¾ˆå¯†åˆ‡çš„è”ç³»ï¼Œå› æ­¤å·¥ç¨‹å¸ˆä¸€èˆ¬ä¼šå¯¹äºŒè€…åŒæ—¶è®¾è®¡ã€ç¼–ç å’Œæµ‹è¯•ã€‚äºæ˜¯åœ¨è¿™é‡Œé¢å¤–å®šä¹‰ä¸€ä¸ª MapReducerï¼Œæ–¹ä¾¿å¼€å‘è€…ç®¡ç† mapper å’Œ reducer çš„é€»è¾‘ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapReducer is the interface that groups the basic Map and Reduce methods.</span></span><br><span class="line"><span class="keyword">type</span> MapReducer <span class="keyword">interface</span> &#123;</span><br><span class="line">    Mapper</span><br><span class="line">    Reducer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Encoder å’Œ Decoder å®šä¹‰æ•°æ®çš„ç¼–è§£ç è¿‡ç¨‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Encoder is the interface that wraps the basic Encode method.</span></span><br><span class="line"><span class="keyword">type</span> Encoder <span class="keyword">interface</span> &#123;</span><br><span class="line">    Encode(v any) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Decoder is the interface that wraps the basic Decode method.</span></span><br><span class="line"><span class="keyword">type</span> Decoder <span class="keyword">interface</span> &#123;</span><br><span class="line">    Decode(v any) error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°½ç®¡åœ¨å®ç°è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯æ ‡å‡†åº“ä¸­çš„ json.Encoder å’Œ json.Decoderï¼Œä½†è¿™é‡Œå¾ˆæœ‰å¿…è¦å°†è¿™ä¸¤ä¸ªè¿‡ç¨‹æç‚¼å‡ºæ¥ï¼Œå¼ºè°ƒå®ƒçš„é‡è¦æ€§ã€‚</p>
<h3 id="ä¸šåŠ¡è§„åˆ™-business-rules">2.3 ä¸šåŠ¡è§„åˆ™ (Business Rules)</h3>
<h4 id="ä¸€æ¬¡ä»»åŠ¡å…³è”çš„æ–‡ä»¶">2.3.1 ä¸€æ¬¡ä»»åŠ¡å…³è”çš„æ–‡ä»¶</h4>
<p>åœ¨ä¸€æ¬¡ MapReduce job æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæ¶‰åŠå¤šå°‘ä¸ªä¸åŒçš„æ–‡ä»¶ï¼Ÿå‡è®¾å…±æœ‰ M ä¸ª map taskï¼ŒR ä¸ª reduce taskï¼Œæˆ‘ä»¥æ–‡ä»¶è§†è§’ç”»äº†ä¸€å¼ ç¤ºæ„å›¾ï¼š</p>
<p><img src="./map-reduce-files.png" /></p>
<p>ä¸€èˆ¬æ‹†åˆ†åçš„è¾“å…¥å­æ–‡ä»¶ä¼šè¢«æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿ (å¦‚ HDFS) çš„æŸä¸ªç›®å½•ä¸‹ã€‚ç›®å½•ä¸­æ–‡ä»¶çš„æ•°é‡å³ä¸ºéœ€è¦æ‰§è¡Œçš„ map task æ•°é‡ Mã€‚ç”±äºåœ¨ reduce é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å°†é”®ç›¸åŒçš„é”®å€¼å¯¹æ”¾è¿›åŒä¸€ä¸ª reduce task ä¸­å¤„ç†ï¼Œè€Œ map task çš„è¾“å…¥æ–‡ä»¶ä¸­å¯èƒ½åŒ…å«ä»»æ„é”®å€¼å¯¹ï¼Œå› æ­¤æ¯ä¸ª map task åœ¨æ‰§è¡Œæ—¶éƒ½å¯èƒ½è¾“å‡ºåˆ° R ä¸ª mapped file é‡Œï¼Œä¸­é—´æ–‡ä»¶çš„æ€»æ•°ä¸º MRã€‚æ¯ä¸ª reduce task ä¼šè¯»å–æ•£åˆ—å€¼ç›¸åŒçš„æ‰€æœ‰ mapped fileï¼Œç„¶åæ‰§è¡Œæ’åºå’Œ reduce é€»è¾‘ï¼Œè¾“å‡ºåˆ°ä¸€ä¸ª reduced file é‡Œã€‚å°†æ‰€æœ‰ reduced files åˆå¹¶å°±èƒ½å¾—åˆ°æœ€ç»ˆç»“æœæ–‡ä»¶ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€æ¬¡ä»»åŠ¡å…³è”çš„æ–‡ä»¶æ€»æ•°ä¸º <code>M + MR + R + 1</code>ã€‚åœ¨æˆ‘ä»¬çš„è®¡ç®—å¼•æ“ä¸­ï¼Œç”¨æˆ·åœ¨æäº¤ä»»åŠ¡æ—¶ï¼Œä¼šé€šè¿‡è¾“å…¥æ–‡ä»¶ç›®å½• (InputDir) æ‰€å«çš„æ–‡ä»¶æ•°é‡ç¡®å®š Mï¼Œé€šè¿‡ Job ä¸­çš„å­—æ®µ R æŒ‡å®š Rã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Job <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id            <span class="keyword">string</span></span><br><span class="line">    InputDir      <span class="keyword">string</span> <span class="comment">// the directory where input files reside</span></span><br><span class="line">    OutputDir     <span class="keyword">string</span> <span class="comment">// the directory where output files reside</span></span><br><span class="line">    ProcessorName <span class="keyword">string</span> <span class="comment">// the name of a MapReducer defined in mapreducers.go</span></span><br><span class="line">    R             <span class="keyword">int</span>    <span class="comment">// number of reduce tasks</span></span><br><span class="line"></span><br><span class="line">    operation *Operation <span class="comment">// job status</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œ-mapreduce-task">2.3.2 æ‰§è¡Œ Map/Reduce Task</h4>
<p>å¼•æ“ä¸­ï¼ŒMapTask å’Œ ReduceTask ä¹‹é—´æœ‰ä¸€ä¸ªéšè—çš„çº¦å®š â€”â€” mapped file çš„å‘½åè§„åˆ™ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mappedFile constructs the name of the mapped file which a MapTask</span></span><br><span class="line"><span class="comment">// generates for the corresponding ReduceTask.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mappedFile</span><span class="params">(jobId <span class="keyword">string</span>, mapTask <span class="keyword">string</span>, reduceTask <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;mrtmp.%s-%s-%s&quot;</span>, jobId, mapTask, reduceTask)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ª mapped file åå­—ç”± jobï¼Œmap task å’Œ reduce task ä¸‰è€…çš„æ ‡è¯†å…±åŒå†³å®šã€‚é€šè¿‡è¿™ä¸ªçº¦å®šï¼Œmapper å’Œ reducer éƒ½èƒ½å¤Ÿåˆ©ç”¨ Mã€R ä»¥åŠ job ä¿¡æ¯è®¡ç®—å¾—åˆ°æ‰€æœ‰ mapped files çš„åœ°å€ã€‚</p>
<h5 id="maptask">2.3.2.1 MapTask</h5>
<p>ä»¥ä¸‹æ˜¯ map task çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­ <code>InputFile</code> æ˜¯è¾“å…¥çš„å­æ–‡ä»¶ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapTask provides all the information needed to run a map task.</span></span><br><span class="line"><span class="keyword">type</span> MapTask <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id        <span class="keyword">string</span></span><br><span class="line">    InputFile <span class="keyword">string</span> <span class="comment">// the input file to map phase.</span></span><br><span class="line">    Job       *Job</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ map è¿‡ç¨‹æ—¶ï¼Œéœ€è¦æ‰“å¼€ 1 ä¸ªè¾“å…¥æ–‡ä»¶å’Œ R ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œåˆ©ç”¨å¼€å‘è€…è‡ªå®šä¹‰çš„ mapper å°†åŸå§‹æ•°æ®è½¬åŒ–æˆé”®å€¼å¯¹ï¼Œç„¶åæ ¹æ®é”®çš„å“ˆå¸Œå€¼é€‰æ‹©æ•°æ®åº”è¢«å†™è¿›çš„è¾“å‡ºæ–‡ä»¶ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mt *MapTask)</span> <span class="title">Do</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 1. æ‰“å¼€è¾“å…¥æ–‡ä»¶ï¼Œå¹¶è¯»å–åŸå§‹æ•°æ®</span></span><br><span class="line">    byt, err := ioutil.ReadFile(mt.InputFile)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. å°†åŸå§‹æ•°æ®ä¼ ç»™å¼€å‘è€…è‡ªå®šä¹‰çš„ Map </span></span><br><span class="line">    kvs, err := mapReducer.Map(byt)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. æ‰“å¼€ mapped files</span></span><br><span class="line">    mappedFiles := <span class="built_in">make</span>([]*os.File, <span class="number">0</span>, mt.Job.R)</span><br><span class="line">    encoders := <span class="built_in">make</span>([]Encoder, <span class="number">0</span>, mt.Job.R)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 4. éå†é”®å€¼å¯¹ï¼Œå¹¶åˆ©ç”¨ encoder å†™å‡ºåˆ°ç›¸åº”çš„è¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">var</span> hsh <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> _, kv := <span class="keyword">range</span> kvs &#123;</span><br><span class="line">        <span class="keyword">if</span> hsh, err = hash(kv.Key); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err = encoders[hsh%mt.Job.R].Encode(&amp;kv); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="reducetask">2.3.2.2 ReduceTask</h5>
<p>ä»¥ä¸‹æ˜¯ reduce task çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReduceTask provides all the information needed to run a reduce task.</span></span><br><span class="line"><span class="keyword">type</span> ReduceTask <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id  <span class="keyword">string</span></span><br><span class="line">    M   <span class="keyword">int</span> <span class="comment">// number of map tasks</span></span><br><span class="line">    Job *Job</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ reduce æ—¶ï¼Œéœ€è¦æ‰“å¼€ M ä¸ªè¾“å…¥æ–‡ä»¶å’Œ 1 ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œå…ˆè¯»å– M ä¸ªè¾“å…¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®ï¼ŒæŒ‰é”®æ’åºåï¼Œå°†é”®ç›¸åŒçš„æ•°æ®ä¸€ç»„ä¸€ç»„åœ°äº¤ç”±å¼€å‘è€…å®šä¹‰çš„ reducer å¤„ç†ï¼Œå¹¶å°†å¾—åˆ°çš„è®¡ç®—ç»“æœå†™è¿›è¾“å‡ºæ–‡ä»¶ã€‚åœ¨è®ºæ–‡ä¸­æåˆ°è¿‡ï¼Œå¦‚æœæ— æ³•åœ¨å†…å­˜ä¸­å®Œæˆæ‰€æœ‰æ•°æ®çš„æ’åºï¼Œå°†ä½¿ç”¨å¤–éƒ¨æ’åºç®—æ³•ï¼Œæœ¬é¡¹ç›®ä¸ºäº†ç®€å•ç›´æ¥å¿½ç•¥äº†è¿™ç§æƒ…å†µã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rt *ReduceTask)</span> <span class="title">Do</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> kvs []KeyValue</span><br><span class="line">    <span class="comment">// 1. è¯»å– M ä¸ªè¾“å…¥æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹åˆ° kvs ä¸­</span></span><br><span class="line">    <span class="keyword">var</span> mf *os.File</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rt.M; i++ &#123;</span><br><span class="line">        mf, err = os.Open(mappedFile(rt.Job.Id, strconv.Itoa(i), rt.Id))</span><br><span class="line">        <span class="comment">// handle err and close file...</span></span><br><span class="line">        <span class="keyword">var</span> shard []KeyValue</span><br><span class="line">        <span class="comment">// decode map file into shard...</span></span><br><span class="line">        kvs = <span class="built_in">append</span>(kvs, shard...)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. æŒ‰é”®æ’åº</span></span><br><span class="line">    sort.Slice(kvs, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kvs[i].Key &lt; kvs[j].Key</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 3. å°†é”®ç›¸åŒçš„æ•°æ®ä¸€ç»„ä¸€ç»„åœ°ä¼ å…¥ Reduce</span></span><br><span class="line">    <span class="keyword">var</span> rkvs []KeyValue</span><br><span class="line">    <span class="keyword">var</span> k, v <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> vs []<span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i &lt; <span class="built_in">len</span>(kvs) &#123;</span><br><span class="line">        k, vs = kvs[i].Key, <span class="built_in">append</span>(vs, kvs[i].Value)</span><br><span class="line">        <span class="keyword">for</span> i+<span class="number">1</span> &lt; <span class="built_in">len</span>(kvs) &amp;&amp; kvs[i+<span class="number">1</span>].Key == k &#123;</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            vs = <span class="built_in">append</span>(vs, kvs[i].Value)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> v, err = mapReducer.Reduce(k, vs); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        rkvs = <span class="built_in">append</span>(rkvs, KeyValue&#123;Key: k, Value: v&#125;)</span><br><span class="line">        vs = vs[:<span class="number">0</span>]</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. å°†ç»“æœå†™å‡º</span></span><br><span class="line">    <span class="comment">// (çœç•¥)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œå¼•æ“">2.3.3 æ‰§è¡Œå¼•æ“</h4>
<h5 id="é€šä¿¡åè®®">2.3.3.1 é€šä¿¡åè®®</h5>
<p>MapReduce job çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†è¿›ç¨‹é—´é€šä¿¡ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ go æ ‡å‡†åº“é‡Œçš„ <code>net/rpc</code> ä½œä¸ºé€šä¿¡åè®®ã€‚MapReduce é›†ç¾¤ä¸­æœ‰ä¸¤ç§èŠ‚ç‚¹ï¼šMaster å’Œ Workerï¼ŒMaster è´Ÿè´£ä»»åŠ¡çš„è°ƒåº¦å’Œç»“æœæ±‡æ€»ï¼ŒWorker è´Ÿè´£æ‰§è¡Œå…·ä½“çš„è®¡ç®—è¿‡ç¨‹ã€‚</p>
<p>master ä¸­éœ€è¦å­˜å‚¨æ‰€æœ‰æ³¨å†ŒèŠ‚ç‚¹çš„åœ°å€ï¼Œå³ç»“æ„ä½“ Master ä¸­çš„ workers å­—æ®µã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Master is the concrete type for Master node described in the original paper.</span></span><br><span class="line"><span class="keyword">type</span> Master <span class="keyword">struct</span> &#123;</span><br><span class="line">    Address <span class="keyword">string</span></span><br><span class="line">    lsn     net.Listener</span><br><span class="line"></span><br><span class="line">    mu      sync.Mutex             <span class="comment">// protects the following fields.</span></span><br><span class="line">    wi      <span class="keyword">int</span>                    <span class="comment">// index of current worker, used to implement round-robin strategy.</span></span><br><span class="line">    workers []<span class="keyword">string</span>               <span class="comment">// registered worker addresses.</span></span><br><span class="line">    clients <span class="keyword">map</span>[<span class="keyword">string</span>]*rpc.Client <span class="comment">// map worker (address) to it&#x27;s rpc client.</span></span><br><span class="line">    jobs    <span class="keyword">map</span>[<span class="keyword">string</span>]*Job        <span class="comment">// in-memory job store, which maps operation id to job.</span></span><br><span class="line"></span><br><span class="line">    shutdown <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å•ä¸ª worker å¯åŠ¨åé€šè¿‡ master æš´éœ²çš„ Register æ¥å£å°†è‡ªå·±çš„æœåŠ¡ä¿¡æ¯æ³¨å†Œä¸Šå»ï¼Œ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RegisterArgs represents arguments passed when a worker node calls Register.</span></span><br><span class="line"><span class="keyword">type</span> RegisterArgs <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// the communication endpoint of worker process,</span></span><br><span class="line">    <span class="comment">// such as IPC socket or Network socket</span></span><br><span class="line">    Worker <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register is called when a Worker node wants to register itself to the Master node.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Master)</span> <span class="title">Register</span><span class="params">(args *RegisterArgs, _ *<span class="keyword">struct</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    m.mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> m.mu.Unlock()</span><br><span class="line">    <span class="comment">// ignore all sanity checks.</span></span><br><span class="line">    m.workers = <span class="built_in">append</span>(m.workers, args.Worker)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œmaster å°±å¯ä»¥æ ¹æ®ç”¨æˆ·æäº¤çš„ jobï¼Œå°†å¯¹åº”çš„ map task å’Œ reduce task æ´¾å‘ç»™è‹¥å¹² worker èŠ‚ç‚¹ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨çš„æ˜¯ worker èŠ‚ç‚¹æä¾›çš„ DoMapTask å’Œ DoReduceTask æ¥å£ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DoMapTaskArgs represents arguments passed to Worker.DoMapTask.</span></span><br><span class="line"><span class="keyword">type</span> DoMapTaskArgs <span class="keyword">struct</span> &#123;</span><br><span class="line">    MapTask *MapTask</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DoMapTask executes the given map task synchronously.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">DoMapTask</span><span class="params">(args *DoMapTaskArgs, _ *<span class="keyword">struct</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;worker %s start doing map task %s\n&quot;</span>, w.address, args.MapTask.Id)</span><br><span class="line">    <span class="keyword">return</span> args.MapTask.Do()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DoReduceTaskArgs represents arguments passed to Worker.DoReduceTask.</span></span><br><span class="line"><span class="keyword">type</span> DoReduceTaskArgs <span class="keyword">struct</span> &#123;</span><br><span class="line">    ReduceTask *ReduceTask</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DoReduceTask executes the given reduce task synchronously.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">DoReduceTask</span><span class="params">(args *DoReduceTaskArgs, _ *<span class="keyword">struct</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;worker %s start doing reduce task %s\n&quot;</span>, w.address, args.ReduceTask.Id)</span><br><span class="line">    <span class="keyword">return</span> args.ReduceTask.Do()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="é¡ºåºå¼•æ“">2.3.3.2 é¡ºåºå¼•æ“</h5>
<p>é¡ºåºæ‰§è¡Œå¼•æ“åªç”¨ä¸€ä¸ª worker æ¥æ‰§è¡Œæ‰€æœ‰çš„ map/reduce taskï¼Œå…¶æœ¬èº«çš„å­˜åœ¨æ„ä¹‰å¹¶ä¸å¤§ï¼Œä¸»è¦ç”¨äºéªŒè¯æ¦‚å¿µï¼Œç¡®è®¤æ ¸å¿ƒæµç¨‹çš„æ­£ç¡®æ€§ã€‚å®ç°é¡ºåºå¼•æ“åå†å®ç°åˆ†å¸ƒå¼å¼•æ“å°±ä¼šæ›´èƒ¸æœ‰æˆç«¹ä¸€äº›ã€‚</p>
<p>å¿½ç•¥å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œé¡ºåºå¼•æ“çš„å¤§ä½“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sequential runs the map/reduce job sequentially on an arbitrary Worker node.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Master)</span> <span class="title">sequential</span><span class="params">(args *SubmitArgs, operation *Operation)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    job := args.Job</span><br><span class="line">    files, _ := ioutil.ReadDir(job.InputDir)</span><br><span class="line">    client, _ := m.getClient()</span><br><span class="line">    <span class="comment">// map phase</span></span><br><span class="line">    <span class="keyword">for</span> i, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">        doTaskArgs := &amp;DoMapTaskArgs&#123;</span><br><span class="line">            MapTask: &amp;MapTask&#123;</span><br><span class="line">                Id:        strconv.Itoa(i),</span><br><span class="line">                InputFile: path.Join(job.InputDir, file.Name()),</span><br><span class="line">                Job:       job,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">        _ = client.Call(<span class="string">&quot;Worker.DoMapTask&quot;</span>, doTaskArgs, <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// reduce phase</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; job.R; i++ &#123;</span><br><span class="line">        doTaskArgs := &amp;DoReduceTaskArgs&#123;</span><br><span class="line">            ReduceTask: &amp;ReduceTask&#123;</span><br><span class="line">                Id:  strconv.Itoa(i),</span><br><span class="line">                Job: job,</span><br><span class="line">                M:   <span class="built_in">len</span>(files),</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">        _ = client.Call(<span class="string">&quot;Worker.DoReduceTask&quot;</span>, doTaskArgs, <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// remove temporary files...</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="åˆ†å¸ƒå¼å¼•æ“">2.3.3.3 åˆ†å¸ƒå¼å¼•æ“</h5>
<p>ä¸é¡ºåºå¼•æ“ä¸åŒï¼Œåˆ†å¸ƒå¼å¼•æ“ä¼šå°†æ‰€æœ‰ map/reduce task åˆ†å‘ç»™å½“å‰å¯ç”¨çš„å¤šä¸ª workerï¼Œå®ç°è®¡ç®—çš„æ¨ªå‘æ‰©å®¹ã€‚æ ¸å¿ƒé€»è¾‘ä¸é¡ºåºå¼•æ“å¤§ä½“ç›¸åŒï¼Œåªæ˜¯ä¼šé¢å¤–ä½¿ç”¨ <code>sync.WaitGroup</code> åœ¨ Map é˜¶æ®µå’Œ Reduce é˜¶æ®µåˆ†åˆ«å®ç°è®¡ç®—é€»è¾‘çš„ fan-out å’Œ fan-inã€‚Map é˜¶æ®µå®ç°ç‰‡æ®µå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// distributed runs the map/reduce job on available Worker nodes in a distributed manner.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Master)</span> <span class="title">distributed</span><span class="params">(args *SubmitArgs, operation *Operation)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// map phase</span></span><br><span class="line">    <span class="keyword">var</span> mwg sync.WaitGroup</span><br><span class="line">    mwg.Add(<span class="built_in">len</span>(files))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> client *rpc.Client</span><br><span class="line">    <span class="keyword">for</span> i, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">        doTaskArgs := &amp;DoMapTaskArgs&#123;</span><br><span class="line">            MapTask: &amp;MapTask&#123;</span><br><span class="line">                Id:        strconv.Itoa(i),</span><br><span class="line">                InputFile: path.Join(job.InputDir, file.Name()),</span><br><span class="line">                Job:       job,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        client, _ = m.getClient()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            rpcErr := client.Call(<span class="string">&quot;Worker.DoMapTask&quot;</span>, doTaskArgs, <span class="literal">nil</span>)</span><br><span class="line">            <span class="keyword">if</span> rpcErr != <span class="literal">nil</span> &#123;</span><br><span class="line">                operation.Error = rpcErr</span><br><span class="line">            &#125;</span><br><span class="line">            mwg.Done()</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">    mwg.Wait()</span><br><span class="line">    log.Println(<span class="string">&quot;MapTask phase done.&quot;</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="api">2.4 API</h3>
<p>å¯¹ç”¨æˆ·è€Œè¨€ï¼ŒMapReduce å¼•æ“åªéœ€è¦æš´éœ²æäº¤è®¡ç®—ä»»åŠ¡çš„æ¥å£å³å¯ã€‚å¯¹äºä¸åŒçš„è®¡ç®—ä»»åŠ¡ï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´å¯ä»åˆ†é’Ÿçº§ã€å°æ—¶çº§åˆ°å¤©çº§ç”šè‡³æ›´é•¿çš„æ—¶é—´ï¼ŒåŒæ­¥çš„æ¥å£å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚è¿™é‡Œå€Ÿé‰´äº† googleapis ä¸­çš„ <a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/tree/master/google/longrunning">Long Running Operations API</a>ï¼Œç”¨æˆ·é€šè¿‡ SubmitJob æ¥å£æäº¤ MapReduce jobï¼Œç„¶åå¾—åˆ°ä¸€ä¸ª Operation ç»“æ„ï¼Œè¡¨ç¤ºä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SubmitArgs represents arguments passed when a client calls SubmitJob.</span></span><br><span class="line"><span class="keyword">type</span> SubmitArgs <span class="keyword">struct</span> &#123;</span><br><span class="line">    Job         *Job <span class="comment">// description of the job to submit</span></span><br><span class="line">    Distributed <span class="keyword">bool</span> <span class="comment">// indicates whether the job should be scheduled distributively</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Operation is the reply from Master node when a client calls SubmitJob.</span></span><br><span class="line"><span class="keyword">type</span> Operation <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id    <span class="keyword">string</span></span><br><span class="line">    Done  <span class="keyword">bool</span></span><br><span class="line">    Error error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SubmitJob is called when a client wants to submit a new job to Master node.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Master)</span> <span class="title">SubmitJob</span><span class="params">(args *SubmitArgs, operation *Operation)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·å¯ä»¥åˆ©ç”¨ operation ä¿¡æ¯å’Œ GetOperation æ¥å£éšæ—¶æŸ¥è¯¢ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetOperationArgs represents arguments passed when a client calls GetOperation.</span></span><br><span class="line"><span class="keyword">type</span> GetOperationArgs <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetOperation requests the operation status of a map/reduce job.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Master)</span> <span class="title">GetOperation</span><span class="params">(args *GetOperationArgs, operation *Operation)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="demo">2.5 Demo</h3>
<p>åœ¨ Go è¿è¡Œæ—¶ä¸­åŠ¨æ€åŠ è½½ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°å¹¶ä¸æ˜¯ä¸€ä»¶å¾ˆå®¹æ˜“çš„äº‹ï¼Œç”±äºè¿™éƒ¨åˆ†åŠŸèƒ½å¹¶éæœ¬é¡¹ç›®çš„ä¸»è¦å…³æ³¨ç‚¹ï¼Œæœ¬é¡¹ç›®ç›´æ¥å°†æ¯ä¸ªä»»åŠ¡å¯¹åº”çš„ MapReducer ç»Ÿä¸€å®šä¹‰åˆ°é¡¹ç›®æºç çš„ <a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/pset/blob/main/map-reduce/go/mapreduce/mapreducers.go">mapreducers.go</a> ä¸­ã€‚å—é™äºè¿™ä¸ªé€‰æ‹©ï¼Œè¿™ä¸ªç©å…·ç‰ˆ MapReduce å¼•æ“å¹¶æ— æ³•çœŸæ­£æ”¯æŒç”¨æˆ·æäº¤ä»»æ„è‡ªå®šä¹‰ MapReduce jobã€‚</p>
<h4 id="wordcount">2.5.1 WordCount</h4>
<p>WordCount å³ã€Œè¯é¢‘è®¡ç®—ã€ï¼Œæ˜¯ MapReduce ä¸–ç•Œçš„ "hello, world"ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> WordCount <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wc WordCount)</span> <span class="title">Map</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">(kvs []KeyValue, err error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, byt := <span class="keyword">range</span> bytes.Fields(data) &#123;</span><br><span class="line">        kvs = <span class="built_in">append</span>(kvs, KeyValue&#123;</span><br><span class="line">            Key:   <span class="keyword">string</span>(byt),</span><br><span class="line">            Value: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wc WordCount)</span> <span class="title">Reduce</span><span class="params">(key <span class="keyword">string</span>, values []<span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> strconv.Itoa(<span class="built_in">len</span>(values)), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WordCount çš„ mapper åªéœ€è¦å°†æ–‡æœ¬åˆ†è¯åè¾“å‡º "[word], 1"ã€‚reducer æ‰§è¡Œæ—¶ï¼Œä»»æ„ä¸€ä¸ªè¯ï¼Œå¦‚ "hello" å¯¹åº”çš„é”®å€¼å¯¹ "hello, 1" ä¼šè¢«åˆå¹¶ï¼Œå› æ­¤è¿™é‡Œ Reduce å‡½æ•°çš„è¾“å…¥ key ä¸º "hello"ï¼Œvalues ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <code>["1", "1", ..., "1"]</code>ï¼Œè¯¥å‡½æ•°åªéœ€è¿”å›è¿™ä¸ªæ•°ç»„çš„é•¿åº¦å³å¾—åˆ°å•è¯ "hello" çš„å‡ºç°æ¬¡æ•°ã€‚</p>
<p>ä»¥èå£«æ¯”äºšçš„èŠ‚é€‰ä¸ºä¾‹ï¼Œæ‰§è¡Œæµ‹è¯•å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">t.Run(<span class="string">&quot;word count (sequential)&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    operation := <span class="built_in">new</span>(Operation)</span><br><span class="line">    err = client.Call(<span class="string">&quot;Master.SubmitJob&quot;</span>, &amp;SubmitArgs&#123;</span><br><span class="line">        Job: &amp;Job&#123;</span><br><span class="line">            InputDir:      <span class="string">&quot;./mixtures/wc/input&quot;</span>,</span><br><span class="line">            OutputDir:     <span class="string">&quot;./mixtures/wc/output&quot;</span>,</span><br><span class="line">            ProcessorName: <span class="string">&quot;wc&quot;</span>,</span><br><span class="line">            R:             <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        Distributed: <span class="literal">false</span>,</span><br><span class="line">    &#125;, operation)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        t.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    _wait(t, client, operation)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥åœ¨ <code>./mixtures/wc/output</code> æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°ç›¸åº”çš„ reduced filesï¼Œå…¶ä¸­ä¸€ä¸ªè¾“å‡ºç‰‡æ®µå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;Key&quot;:&quot;Feed&#x27;st&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;From&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;His&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;How&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;Pity&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;Shall&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;This&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;Thou&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;When&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">&#123;&quot;Key&quot;:&quot;Will&quot;,&quot;Value&quot;:&quot;1&quot;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å…‹éš†ä»“åº“ <a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/pset/tree/main/map-reduce/go/mapreduce">ZhengHe-MD/pset Â· GitHub</a>ï¼Œæ‰§è¡Œå¯¹åº”çš„æµ‹è¯•çœ‹çœ‹å§ï¼Ÿ</p>
<h4 id="average">2.5.2 Average</h4>
<p>å‡è®¾æœ‰ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æ¯è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œæƒ³è¦è®¡ç®—è¿™äº›æ•´æ•°çš„å¹³å‡å€¼ï¼Œè¦æ€ä¹ˆåšï¼Ÿæ±‚å¹³å‡å€¼éœ€è¦ä¸¤ä¸ªå€¼ï¼š<code>cnt</code> å’Œ <code>sum</code>ã€‚åœ¨ Map é˜¶æ®µæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ¯ä¸ªå­æ–‡ä»¶è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ª <code>cnt</code> å’Œ <code>sum</code>ï¼Œç„¶ååœ¨ Reduce é˜¶æ®µè®¡ç®— <code>total(sum)/total(cnt)</code> å³å¯ï¼Œç›¸å…³é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Avg <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Avg)</span> <span class="title">Map</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">(kvs []KeyValue, err error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> cnt, sum, num <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> _, byt := <span class="keyword">range</span> bytes.Fields(data) &#123;</span><br><span class="line">        num, err = strconv.Atoi(<span class="keyword">string</span>(byt))</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        sum += num</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    kvs = <span class="built_in">append</span>(kvs,</span><br><span class="line">        KeyValue&#123;Key: <span class="string">&quot;sum&quot;</span>, Value: strconv.Itoa(sum)&#125;,</span><br><span class="line">        KeyValue&#123;Key: <span class="string">&quot;cnt&quot;</span>, Value: strconv.Itoa(cnt)&#125;)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Avg)</span> <span class="title">Reduce</span><span class="params">(key <span class="keyword">string</span>, values []<span class="keyword">string</span>)</span> <span class="params">(value <span class="keyword">string</span>, err error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sum, num <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> values &#123;</span><br><span class="line">        num, err = strconv.Atoi(v)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        sum += num</span><br><span class="line">    &#125;</span><br><span class="line">    value = strconv.Itoa(sum)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ‰€æœ‰è¾“å…¥å­æ–‡ä»¶çš„è¾“å‡ºé”®å€¼å¯¹éƒ½æ˜¯ <code>&#123;"sum": "xxx", "cnt": "yyy"&#125;</code>ï¼Œæˆ‘ä»¬åªèƒ½ç”¨åŒä¸€ä¸ª reducer èšåˆè®¡ç®—ç»“æœï¼Œå› æ­¤ Job.R è®¾ç½®ä¸º 1ã€‚</p>
<h2 id="sql-to-mapreduce-job">3. SQL to MapReduce Job</h2>
<h3 id="select">3.1 Select</h3>
<p>å‡è®¾æœ‰ä¸€å¼ å¤§è¡¨ students è®°å½•ç€å­¦ç”Ÿçš„åŸºæœ¬æ•°æ®ï¼Œè¿™å¼ è¡¨è¢«æ¨ªå‘æ‹†åˆ†æˆä¸¤å¼ å­è¡¨ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line">10001,Michael,24</span><br><span class="line">10002,Jill,26</span><br><span class="line">10003,Richard,18</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line">10004,Hazard,27</span><br><span class="line">10005,Max,25</span><br><span class="line">10010,Alice,20</span><br><span class="line">10018,Jill,29</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æƒ³å®ç°è¿™æ ·ä¸€ä¸ªæŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> name <span class="operator">=</span> &quot;Jill&quot;;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥æ€ä¹ˆå†™è¿™ä¸ª mapreducerï¼Ÿç”¨è‚‰çœ¼æˆ‘ä»¬å¯ä»¥ç›´æ¥è§‚å¯Ÿåˆ°å®ƒçš„ç»“æœåº”è¯¥æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line">10002,Jill,26</span><br><span class="line">10018,Jill,29</span><br></pre></td></tr></table></figure>
<p>ç”±äº select è¿‡ç¨‹åªæœ‰è¿‡æ»¤æ²¡æœ‰èšåˆè®¡ç®—ï¼Œè¿™åŸºæœ¬æ„å‘³ç€ reduce é˜¶æ®µå¯ä»¥æ˜¯ä¸€ä¸ª no-opã€‚é‚£å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯åœ¨ Map é˜¶æ®µè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®å³å¯ï¼Œé”®å€¼å¯¹ä¸­çš„é”®å–è¡Œçš„å”¯ä¸€ id å³å¯ï¼Œå¤„ç†è¿‡ç¨‹ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<p><img src="./map-reduce-select.png" /></p>
<p>å…·ä½“å®ç°è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/pset/blob/main/map-reduce/go/mapreduce/mapreducers.go">pset/mapreducers.go at main Â· ZhengHe-MD/pset Â· GitHub</a>ã€‚</p>
<h3 id="join">3.2 Join</h3>
<p>å‡è®¾æœ‰ä¸¤å¼ è¡¨ï¼Œstudents å’Œ enrollmentsï¼Œåˆ†åˆ«è®°å½•å­¦ç”Ÿä¿¡æ¯å’Œä»–ä»¬çš„é€‰è¯¾ä¿¡æ¯ã€‚å®ƒä»¬åˆ†åˆ«è¢«æ‹†åˆ†æˆä¸¤å¼ å­è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># students-1.csv</span><br><span class="line">students</span><br><span class="line">id,name,age</span><br><span class="line">10001,Michael,24</span><br><span class="line">10002,Jill,26</span><br><span class="line">10003,Richard,18</span><br><span class="line"># students-2.csv</span><br><span class="line">students</span><br><span class="line">id,name,age</span><br><span class="line">10004,Hazard,27</span><br><span class="line">10005,Max,25</span><br><span class="line">10010,Alice,20</span><br><span class="line">10011,Bob,29</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># enrollments-1.csv</span><br><span class="line">enrollments</span><br><span class="line">id,student_id,course</span><br><span class="line">20001,10002,Math</span><br><span class="line">20002,10002,Physics</span><br><span class="line">20003,10003,Math</span><br><span class="line">20004,10003,History</span><br><span class="line">20005,10001,Physics</span><br><span class="line"># enrollments-2.csv</span><br><span class="line">enrollments</span><br><span class="line">id,student_id,course</span><br><span class="line">20006,10001,History</span><br><span class="line">20007,10004,Music</span><br><span class="line">20008,10005,Music</span><br><span class="line">20009,10010,Chemistry</span><br><span class="line">20010,10011,Biology</span><br><span class="line">20010,10011,Math</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨éœ€è¦å®ç°è¿™æ ·ä¸€ä¸ªæŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    enrollments.id,</span><br><span class="line">    enrollments.course</span><br><span class="line">    students.id,</span><br><span class="line">    students.name,</span><br><span class="line">    students.age,</span><br><span class="line"><span class="keyword">FROM</span> enrollments</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> students </span><br><span class="line">  <span class="keyword">ON</span> enrollments.student_id <span class="operator">=</span> students.id;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥æ€ä¹ˆå†™ mapreducerï¼Ÿå› ä¸º join æ¡ä»¶æ˜¯ <code>students.id = enrollments.student_id</code>ï¼Œä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ€è·¯å°±æ˜¯é€‰æ‹©è¢« join çš„å­—æ®µä¸ºé”®å€¼å¯¹ä¸­çš„é”®ï¼Œç„¶åå¯¹åŒä¸€ä¸ªé”®ä¸­ä¸¤è¡¨çš„æ•°æ®æ‰§è¡Œ joinï¼Œå‰è€…å¯¹åº”çš„å°±æ˜¯ map é˜¶æ®µï¼Œåè€…ä¸º reduce é˜¶æ®µï¼Œå¤„ç†è¿‡ç¨‹ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<p><img src="./map-reduce-join.png" /></p>
<p>å…·ä½“å®ç°è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/pset/blob/main/map-reduce/go/mapreduce/mapreducers.go">pset/mapreducers.go at main Â· ZhengHe-MD/pset Â· GitHub</a>ã€‚</p>
<h2 id="å°¾å£°">4. å°¾å£°</h2>
<p>å®ç°è¿™ä¸ªç©å…·å¼•æ“ï¼Œçš„ç¡®è®©æˆ‘å¯¹ MapReduce æœ‰äº†æ¯”é€šè¯»è®ºæ–‡æ›´æ·±çš„ç†è§£ã€‚è¯šç„¶ï¼Œè¿™ä¸ªå¼•æ“è¿˜æœ‰è¯¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<ol type="1">
<li><p>ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä½¿å¾—å…¶åªèƒ½åˆ©ç”¨ä¸€å°æœºå™¨çš„å¤šä¸ª CPUï¼Œè€Œéå¤šå°æœºå™¨</p></li>
<li><p>æ— æ³•æ”¯æŒå¼€å‘è€…æäº¤è‡ªå®šä¹‰çš„ MapReducer</p></li>
<li><p>Select/Join ä»»åŠ¡å®é™…ä¸Šæœ‰å¾ˆå¤šå¯èƒ½çš„å‚æ•°ç»„åˆå¹¶æœªæ”¯æŒ</p></li>
<li><p>...</p></li>
</ol>
<p>ä¸è¿‡ç›®å‰çš„è®¤è¯†æš‚æ—¶å¤Ÿç”¨ï¼Œå¸Œæœ›æœ‰ä¸€å¤©åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°ç›¸å…³çš„é—®é¢˜ï¼Œèƒ½æœ‰æœºä¼šè¿›ä¸€æ­¥æ¢ç´¢å¤§æ•°æ®ç³»ç»Ÿçš„å¥¥ä¹‰ã€‚</p>
<h2 id="å‚è€ƒ">5. å‚è€ƒ</h2>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://static.googleusercontent.com/media/research.google.com/zh-CN//archive/mapreduce-osdi04.pdf">MapReduce: Simplified Data Processing on Large Clusters</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.824/general.html">MIT-6.824</a>, <a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/distributed-system-lab-codes-2018">GitHub - ZhengHe-MD/distributed-system-lab-codes-2018</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/ZhengHe-MD/pset/tree/main/map-reduce/go/mapreduce">ZhengHe-MD/pset Â· GitHub</a></p></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/blog/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/2022/07/04/A-B-Testing/" rel="prev" title="ä¸€æ¬¡å®éªŒã€ä¸¤ç§é”™è¯¯ã€ä¸‰ä¸ªç›´è§‰">
                  <i class="fa fa-chevron-left"></i> ä¸€æ¬¡å®éªŒã€ä¸¤ç§é”™è¯¯ã€ä¸‰ä¸ªç›´è§‰
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/2022/09/29/my-takes-on-interviews/" rel="next" title="é¢è¯•å®˜æ¯æ‰æŠ€æœ¯é¢è¯•çš„ä¸‰å¤§æ³•å®">
                  é¢è¯•å®˜æ¯æ‰æŠ€æœ¯é¢è¯•çš„ä¸‰å¤§æ³•å® <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhengHe</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/blog/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"zhenghe-hexo-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/blog/js/third-party/comments/disqus.js"></script>

</body>
</html>
